---
title: "Marianadin"
author: "Esteban Marianadin"
format: html
---

### Github Link : 
https://github.com/esteban-mrnd/test-grades.git


```{r}
library(here)
library(ggplot2)
library(tidyr)
library(dplyr)
library(vroom)
library(knitr)
```

```{r}
here::i_am("test-grades.Rproj")
```

# Introduction 

### Question 1

```{r}
courses <- vroom(here("data", "courses.csv"))
```

### Question 2

```{r}

courses |>
  arrange(course) |>
  rename(
    `course name`      = course,
    identifier         = course_id,
    semester           = semester,
    `number of grades` = nb_grades
  ) |>
  knitr::kable()

```

### Question 3

```{r}
library(vroom)

students <- vroom(here("data", "students.csv"),
  col_types = cols(
    id = col_integer(),
    group = col_factor(),
    birth_date = col_date(),
    sex = col_factor()
  )
)

```

The `birth_date` column of the `students` data frame is of class `r class(students$birth_date)`. The `sex` column is of class `r class(students$sex)`.


### Question 4

```{r}
library(vroom)

grades <- vroom(here("data","grades.csv"),
  delim = ":",
  na = "unknown",
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)

```




# Student population analysis


### Question 5


```{r}
students |>
  summarise(n = n(), .by = group) |>
  ggplot(aes(x = group, y = n)) +
  geom_col() +
  labs(x = "Group", y = "Number of students")


```

### Question 6


```{r}
students |>
  filter(!is.na(sex)) |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  labs(
    x = "Group",
    y = "Proportion",
    fill = "Sex"
  )


```



### Question 7

```{r}
library(lubridate)

students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year")
  ) |>
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1) +
  labs(
    x = "Age",
    y = "Count"
  )

```


### Question 8


```{r}
library(lubridate)
library(dplyr)

median_age_group <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year"),
    median_age = median(age),
    .by = group
  ) |>
  distinct(group, median_age)

knitr::kable(median_age_group)

```


### Question 9


```{r}
library(lubridate)
library(dplyr)

oldest <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year")
  ) |>
  slice_max(age, n = 1, by = group) |>
  select(id, sex, age, group) |>
  arrange(desc(age))

knitr::kable(oldest)

```

# Simple Grade Analysis

### Question 10

The data set contains `r sum(!is.na(grades$grade))` grades.

### Question 11

```{r}
grades_full <- grades |>
  inner_join(students, by = "id") |>
  inner_join(courses, by = "course_id")

grades_full |>
  filter(course == "Storytelling and Oral Tradition", !is.na(grade)) |>
  summarise(avg = mean(grade), .by = group) |>
  ggplot(aes(x = group, y = avg)) +
  geom_col() +
  labs(
    x = "Group",
    y = "Average grade",
    title = "Average grade in 'Storytelling and Oral Tradition' by group"
  )


```


### Question 12



```{r}
grades_full |>
  filter(!is.na(grade)) |>
  ggplot(aes(x = grade)) +
  geom_density() +
  facet_wrap(vars(semester)) +
  labs(
    x = "Grade",
    y = "Density",
    title = "Distribution of grades by semester"
  )

```
The average grade is slightly lower in the first semester, the standard deviation is also lower in the first semester. 




# Attendance Analysis


### Question 13

```{r}
grades_per_student <- grades_full |>
  filter(!is.na(grade)) |>
  summarise(nb_grades = n(), .by = c(id, group, sex))

```


```{r}
grades_per_student |>
  slice_head(n = 5) |>
  knitr::kable()

```

```{r}
stats <- grades_per_student |>
  summarise(
    minimum = min(nb_grades),
    maximum = max(nb_grades),
    average = mean(nb_grades),
    median  = median(nb_grades)
  )

knitr::kable(stats)

```


### Question 14


```{r}
grades_per_student |>
  ggplot(aes(x = nb_grades, color = sex, fill = sex)) +
  geom_density(alpha = 0.4) +
  labs(
    x = "Number of grades",
    y = "Density",
    color = "Sex",
    fill = "Sex",
    title = "Distribution of number of grades by sex"
  )

```

This graph shows that male students tends to attend more exams than female students but that the number of students who attended every exam is almost equal for both sex.



### Question 15

```{r}
shamanism_counts <- grades_full |>
  filter(course == "Shamanism and Spirit Communication") |>
  filter(!is.na(grade)) |>
  summarise(nb_grades = n(), .by = c(id, group))

shamanism_counts |>
  slice_head(n = 5) |>
  knitr::kable()

```


### Question 16


```{r}
dist_shamanism <- shamanism_counts |>
  summarise(n = n(), .by = nb_grades)

dist_shamanism |>
  ggplot(aes(x = nb_grades, y = n)) +
  geom_col() +
  labs(
    x = "Number of grades in Shamanism and Spirit Communication",
    y = "Number of students",
    title = "Distribution of grades in Shamanism and Spirit Communication"
  )


```


### Question 17


```{r}
shamanism_counts |>
  ggplot(aes(x = group, y = nb_grades)) +
  geom_boxplot() +
  labs(
    x = "Group",
    y = "Number of grades in Shamanism",
    title = "Does the number of grades in Shamanism depend on the group?"
  )

```



### Question 18

```{r}
shamanism_counts <- grades_full |>
  filter(course == "Shamanism and Spirit Communication") |>
  filter(!is.na(grade)) |>
  summarise(nb_grades = n(), .by = c(id, group, sex))

shamanism_counts |>
  ggplot(aes(x = group, y = nb_grades, fill = sex)) +
  geom_boxplot() +
  labs(
    x = "Group",
    y = "Number of grades in Shamanism",
    fill = "Sex",
    title = "Does the number of grades depend on group and sex?"
  )


```

# Grade Analysis 


### Question 19

```{r}
student_course_avg <- grades_full |>
  filter(!is.na(grade)) |>
  summarise(
    avg_grade = mean(grade),
    .by = c(id, group, course)
  )

grades_wide <- student_course_avg |>
  pivot_wider(
    id_cols    = c(id, group),
    names_from  = course,
    values_from = avg_grade
  )

grades_wide |>
  select(
    id,
    group,
    `Animal Lore and Totemism`,
    `Astronomy and Celestial Navigation`
  ) |>
  slice_head(n = 5) |>
  knitr::kable()

```


### Question 20

```{r}
library(ggplot2)
library(dplyr)

grades_wide |>
  ggplot(aes(
    x = `Tribal Law and Customs`,
    y = `Herbalism and Traditional Medicine`
  )) +
  geom_point(alpha = 0.7) +
  geom_smooth(se = FALSE) +
  labs(
    x = "Average grade in Tribal Law and Customs",
    y = "Average grade in Herbalism and Traditional Medicine",
    title = "Relationship between performance in Tribal Law and Herbalism"
  )

```


### Question 21

```{r}
cor_dm_sham_by_group <- grades_wide |>
  summarise(
    correlation = cor(
      `Drumming and Music`,
      `Shamanism and Spirit Communication`
    ),
    .by = group
  )

knitr::kable(cor_dm_sham_by_group)

```

### Question 22

```{r}
best_group <- cor_dm_sham_by_group |>
  mutate(abs_cor = abs(correlation)) |>
  slice_max(abs_cor, n = 1) |>
  pull(group)

grades_wide |>
  filter(group == best_group) |>
  ggplot(aes(
    x = `Shamanism and Spirit Communication`,
    y = `Drumming and Music`
  )) +
  geom_point(alpha = 0.7) +
  geom_smooth(se = FALSE) +
  labs(
    x = "Average grade in Shamanism and Spirit Communication",
    y = "Average grade in Drumming and Music",
    title = paste(
      "Relationship between Shamanism and Drumming in group", best_group
    )
  )

```

### Question 23


```{r}

grades_wide2 <- grades_wide |>
  inner_join(students |> select(id, sex), by = "id")

final_grades <- grades_wide2 |>
  pivot_longer(
    cols = -c(id, group, sex),
    names_to  = "course",
    values_to = "avg_grade"
  ) |>
  summarise(
    final_grade = mean(avg_grade, na.rm = TRUE),
    .by = c(id, group, sex)
  ) |>
  arrange(desc(final_grade))


final_grades |>
  slice_head(n = 5) |>
  knitr::kable()


```


### Question 24

```{r}
final_grades |>
  ggplot(aes(x = group, y = final_grade)) +
  geom_boxplot() +
  labs(
    x = "Group",
    y = "Final grade",
    title = "Distribution of final grades by group"
  )

```


### Question 25

```{r}
final_grades |>
  ggplot(aes(x = group, y = final_grade, fill = sex)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    x = "Group",
    y = "Final grade",
    fill = "Sex",
    title = "Final grade by group and sex"
  )

```



### Question 26

```{r}
student_course_avg <- grades_full |>
  filter(!is.na(grade)) |>
  summarise(
    course_avg = mean(grade),
    .by = c(id, group, sex, course, semester)
  )


has_low_course <- student_course_avg |>
  summarise(
    any_too_low = any(course_avg < 5),
    .by = id
  )

student_semesters <- student_course_avg |>
  summarise(
    semester_avg = mean(course_avg),
    .by = c(id, semester)
  ) |>
  pivot_wider(
    names_from  = semester,
    values_from = semester_avg,
    names_glue  = "semester_{semester}"
  )


pass_table <- final_grades |>
  inner_join(has_low_course,    by = "id") |>
  inner_join(student_semesters, by = "id") |>
  mutate(
    pass = (!any_too_low) &
           (semester_1 >= 10) &
           (semester_2 >= 10)
  ) |>
  select(id, group, final_grade, pass) |>
  arrange(desc(final_grade))

pass_table |>
  arrange(desc(id)) |>
  slice_head(n = 5) |>
  knitr::kable()

```






### Question 27



```{r}
fail_but_good <- pass_table |>
  filter(!pass, final_grade >= 10) |>
  nrow()

```

There are `r fail_but_good` students who do not pass despite having a final grade â‰¥ 10.

### Question 28








