---
title: "Marianadin"
author: "Esteban Marianadin"
format: html
---

```{r}
library(here)
library(ggplot2)
library(tidyr)
library(dplyr)
library(vroom)
library(knitr)
```

```{r}
here::i_am("test-grades.Rproj")
```

# Introduction 

### Question 1

```{r}
courses <- vroom(here("data", "courses.csv"))
```

### Question 2

```{r}

courses |>
  arrange(course) |>
  rename(
    `course name`      = course,
    identifier         = course_id,
    semester           = semester,
    `number of grades` = nb_grades
  ) |>
  knitr::kable()

```

### Question 3

```{r}
library(vroom)

students <- vroom(here("data", "students.csv"),
  col_types = cols(
    id = col_integer(),
    group = col_factor(),
    birth_date = col_date(),
    sex = col_factor()
  )
)

```

The `birth_date` column of the `students` data frame is of class `r class(students$birth_date)`. The `sex` column is of class `r class(students$sex)`.


### Question 4

```{r}
library(vroom)

grades <- vroom(here("data","grades.csv"),
  delim = ":",
  na = "unknown",
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)

```




# Student population analysis


### Question 5


```{r}
students |>
  summarise(n = n(), .by = group) |>
  ggplot(aes(x = group, y = n)) +
  geom_col() +
  labs(x = "Group", y = "Number of students")


```

### Question 6


```{r}
students |>
  filter(!is.na(sex)) |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  labs(
    x = "Group",
    y = "Proportion",
    fill = "Sex"
  )


```



### Question 7

```{r}
library(lubridate)

students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year")
  ) |>
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1) +
  labs(
    x = "Age",
    y = "Count"
  )

```


### Question 8


```{r}
library(lubridate)
library(dplyr)

median_age_group <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year"),
    median_age = round(median(age), 0),
    .by = group
  ) |>
  distinct(group, median_age)

knitr::kable(median_age_group)

```


### Question 9


```{r}
library(lubridate)
library(dplyr)

oldest <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year")
  ) |>
  slice_max(age, n = 1, by = group) |>
  select(id, sex, age, group) |>
  arrange(desc(age))

knitr::kable(oldest)

```

# Simple Grade Analysis

### Question 10

The data set contains `r sum(!is.na(grades$grade))` grades.

### Question 11

```{r}
grades_full <- grades |>
  inner_join(students, by = "id") |>
  inner_join(courses, by = "course_id")

grades_full |>
  filter(course == "Storytelling and Oral Tradition", !is.na(grade)) |>
  summarise(avg = mean(grade), .by = group) |>
  ggplot(aes(x = group, y = avg)) +
  geom_col() +
  labs(
    x = "Group",
    y = "Average grade",
    title = "Average grade in 'Storytelling and Oral Tradition' by group"
  )


```


### Question 12



```{r}
grades_full |>
  filter(!is.na(grade)) |>
  ggplot(aes(x = grade)) +
  geom_density() +
  facet_wrap(vars(semester)) +
  labs(
    x = "Grade",
    y = "Density",
    title = "Distribution of grades by semester"
  )

```



